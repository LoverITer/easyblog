/*!
 * Code block dialog plugin for Editor.md
 *
 * @file        code-block-dialog.js
 * @author      pandao
 * @version     1.2.0
 * @updateTime  2015-03-07
 * {@link       https://github.com/pandao/editor.md}
 * @license     MIT
 */
(function(){var a=function(b){var e;var d="code-block-dialog";var c=b.codeLanguages={asp:["ASP","vbscript"],actionscript:["ActionScript(3.0)/Flash/Flex","clike"],bash:["Bash/Bat","shell"],css:["CSS","css"],c:["C","clike"],cpp:["C++","clike"],csharp:["C#","clike"],coffeescript:["CoffeeScript","coffeescript"],d:["D","d"],dart:["Dart","dart"],delphi:["Delphi/Pascal","pascal"],erlang:["Erlang","erlang"],go:["Golang","go"],groovy:["Groovy","groovy"],html:["HTML","text/html"],java:["Java","clike"],json:["JSON","text/json"],javascript:["Javascript","javascript"],lua:["Lua","lua"],less:["LESS","css"],markdown:["Markdown","gfm"],"objective-c":["Objective-C","clike"],php:["PHP","php"],perl:["Perl","perl"],python:["Python","python"],r:["R","r"],rst:["reStructedText","rst"],ruby:["Ruby","ruby"],sql:["SQL","sql"],sass:["SASS/SCSS","sass"],shell:["Shell","shell"],scala:["Scala","clike"],swift:["Swift","clike"],vb:["VB/VBScript","vb"],xml:["XML","text/xml"],yaml:["YAML","yaml"]};b.fn.codeBlockDialog=function(){var r=this;var n=this.cm;var x=this.lang;var i=this.editor;var u=this.settings;var j=n.getCursor();var w=n.getSelection();var g=this.classPrefix;var m=g+d,s;var l=x.dialog.codeBlock;n.focus();if(i.find("."+m).length>0){s=i.find("."+m);s.find("option:first").attr("selected","selected");s.find("textarea").val(w);this.dialogShowMask(s);this.dialogLockScreen();s.show()}else{var t='<div class="'+g+'code-toolbar">'+l.selectLabel+'<select><option selected="selected" value="">'+l.selectDefaultText+'</option></select></div><textarea placeholder="'+l.placeholder+'" style="display:none;">'+w+"</textarea>";s=this.createDialog({name:m,title:l.title,width:780,height:565,mask:u.dialogShowMask,drag:u.dialogDraggable,content:t,lockScreen:u.dialogLockScreen,maskStyle:{opacity:u.dialogMaskOpacity,backgroundColor:u.dialogMaskBgColor},buttons:{enter:[x.buttons.enter,function(){var z=this.find("textarea").val();var y=this.find("select").val();if(y===""){alert(x.dialog.codeBlock.unselectedLanguageAlert);return false}if(z===""){alert(x.dialog.codeBlock.codeEmptyAlert);return false}y=(y==="other")?"":y;n.replaceSelection(["```"+y,z,"```"].join("\n"));if(y===""){n.setCursor(j.line,j.ch+3)}this.hide().lockScreen(false).hideMask();return false}],cancel:[x.buttons.cancel,function(){this.hide().lockScreen(false).hideMask();return false}]}})}var h=s.find("select");if(h.find("option").length===1){for(var v in c){var p=c[v];h.append('<option value="'+v+'" mode="'+p[1]+'">'+p[0]+"</option>")}h.append('<option value="other">'+l.otherLanguage+"</option>")}var o=h.find("option:selected").attr("mode");var k={mode:(o)?o:"text/html",theme:u.theme,tabSize:4,autofocus:true,autoCloseTags:true,indentUnit:4,lineNumbers:true,lineWrapping:true,extraKeys:{"Ctrl-Q":function(y){y.foldCode(y.getCursor())}},foldGutter:true,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],matchBrackets:true,indentWithTabs:true,styleActiveLine:true,styleSelectedText:true,autoCloseBrackets:true,showTrailingSpace:true,highlightSelectionMatches:true};var q=s.find("textarea");var f=s.find(".CodeMirror");if(s.find(".CodeMirror").length<1){e=b.$CodeMirror.fromTextArea(q[0],k);f=s.find(".CodeMirror");f.css({"float":"none",margin:"8px 0",border:"1px solid #ddd",fontSize:u.fontSize,width:"100%",height:"390px"});e.on("change",function(y){q.val(y.getValue())})}else{e.setValue(n.getSelection())}h.change(function(){var y=$(this).find("option:selected").attr("mode");e.setOption("mode",y)})}};if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object"){module.exports=a}else{if(typeof define==="function"){if(define.amd){define(["editormd"],function(b){a(b)})}else{define(function(c){var b=c("./../../editormd");a(b)})}}else{a(window.editormd)}}})();